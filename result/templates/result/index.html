{% extends 'dashboard/base.html' %}

{% block content %}

<div class="container">
    <label for="book_name">Search Student:</label>
    <input type="text" id="first_name" required autofocus placeholder="First Name">
    <input type="text" id="last_name" required autofocus placeholder="Last Name">    
    <button type="button" class="btn btn-primary" onclick="search_student()">Search</button>
    
    {% if user.is_teacher == True %}
    <a href="/results/new-draft"><button type="button" class="btn btn-primary">Publish New Result Draft</button></a>
    {% endif %}
    <button type="button" class="btn btn-primary" id='explore_button' onclick="show_explore_table()">Explore Results</button>
    <div id="explore_table" class="table-responsive">
        <hr>
        <div class="card shadow">
            <div class="card-header border-0" id="select_title">
            </div>
            <div class="table-responsive">
                <table class="table align-items-center table-flush table-hover">
                <tbody id="result">
                </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



<script>
    $(document).ready(); { 
        $('#search_table').hide();
        $('#explore_button').hide();
        getSemester();

    };

    function show_explore_table(){
        location.reload();
    }


    function getSemester(){
        var xhttp = new XMLHttpRequest();
        info = {
            'request': "get_semester_list",
        }
        $.ajax ({
            type: 'POST',
            url: '/library/get/sem',
            data: JSON.stringify(info),
            success: function(data){
                outputData(data);        
        },
        error: function(data){
                swal("An unexpected error occured, Please report to the devs.", {
                    dangerMode: true,
                    buttons: {
                        confirm: true,
                    },
                    })
            }
        });
        function outputData(data){
            y = y = data['semester'].length;
            $("#select_title").append(
                '<h1>Select Semester</h1>'
            )
            while (y) {
            y = y -1;
            $("#result").append(
                '<tr data-href ="'+data['semester'][y]+'" class="table-row"><td>'+data['semester'][y]+'<td></tr>'
            )
        }
        $(".table-row").click(function() {
        window.document.location = $(this).data("href");
        });
        }
    }

    function getOther(x){
        var xhttp = new XMLHttpRequest();
        info = {
            'request': "get_semester",
        }
        $.ajax ({
            type: 'POST',
            url: '/result/get/'+x,
            data: JSON.stringify(info),
            success: function(data){
                outputData(data);        
        },
        error: function(data){
                swal("An unexpected error occured, Please report to the devs.", {
                    dangerMode: true,
                    buttons: {
                        confirm: true,
                    },
                    })
            }
        });
        function outputData(data){
            y = y = data['semester'].length;
            $("#select_title").append(
                '<h1>Select Semester</h1>'
            )
            while (y) {
            y = y -1;
            $("#result").append(
                '<tr data-href ="'+x+data['year'][y]+'" class="table-row"><td>'+data['year'][y]+'<td></tr>'
            )
        }
        $(".table-row").click(function() {
        window.document.location = $(this).data("href");
        });
        }
    }

    function search_student(){
        var xhttp = new XMLHttpRequest();
        var first_name = $('#first_name').val();
        var last_name = $('#last_name').val();
        var info = {
            'search_type':'name',
            'first_name': first_name,
            'last_name': last_name,
        };
        $.ajax ({
            type: 'POST',
            url: 'search',
            data: JSON.stringify(book_info),
            success: function(data){
                outputData(data);        
        }
        }); 

        function outputData(data){
            y = data['uuid'].length;
            $("tr").remove(".table-row");
            $('#book_name_show').remove();
            $('#insert_book_name').append(
                '<h2 class="mb-0" id="book_name_show"><u><b>Book Name : '+$("#book_name").val()+'</u></h2>');
            var null_assigned;
            var null_due_date;
            var table_property;
            while (y) {
                y = y -1;
                if(data['is_assigned'][y]){
                    null_assigned = data['assigned_to'][y]
                }
                else {
                    null_assigned = 'Avaible!'
                    $('#assign').show();
                }
                if (data['is_overdue'][y]) {
                    table_property = 'table-danger'
                }
                else { 
                    if (data['is_assigned'][y]){
                        table_property = 'Success'
                    }
                }
                $("#search_results").append(
                    '<tr data-href="'+data['uuid'][y]+'" class="table-row"><td class = "'+table_property+'">'+null_assigned+'</td><td>'+data['due_date'][y]+'</td></tr>'
                )
            }
            $(".table-row").click(function() {
            window.document.location = $(this).data("href");
            });
            $('#order_table').hide();   
            $("#search_table").show();
            $('#explore_button').show();
        } 
    }
</script>
    
{% endblock %}